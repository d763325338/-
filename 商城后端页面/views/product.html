<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>产品页</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../css/themes/default/easyui.css"
    />
    <link rel="stylesheet" type="text/css" href="../css/themes/icon.css" />
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
    <script
      type="text/javascript"
      src="../js/jquery.serializejson.min.js"
    ></script>
    <style>
      .textbox-label{
        width: 135px;
      }
      </style>
  </head>
  <body>
    <div class="easyui-layout" data-options="fit:true">
      <div
        data-options="region:'center',title:'产品管理',split:true,collapsible:false"

      >
        <table id="dg"></table>

        <div id="tb" style="padding:2px 5px;">
          <input id="name" label="商品名称:" style="width:300px;" />

          <a
            href="#"
            id="searchData"
            class="easyui-linkbutton"
            iconCls="icon-search"
            >搜索产品名称</a
          >
          <a
            href="#"
            id="addData"
            class="easyui-linkbutton"
            data-options="iconCls:'icon-add'"
            >添加产品</a
          >
          <!-- <a
            href="#"
            id="removesData"
            class="easyui-linkbutton"
            data-options="iconCls:'icon-remove'"
            >Remove</a
          > -->
        </div>

        <div
          id="dlg"
          class="easyui-dialog"
          title="商品信息"
          data-options="iconCls:'icon-save',closed: true"
          style="width:400px;height:500px;padding:10px"
        >
          <form
            id="ff"
            class="easyui-form"
            method="post"
            data-options="novalidate:true"
          >

            <div style="margin-bottom:20px">
              <input
                class="easyui-textbox sid"
                name="sid"
                style="width:100%"
                data-options="label:'商品id:',readonly:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-textbox title"
                name="title"
                style="width:100%"
                data-options="label:'商品标题:',required:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-textbox url"
                name="url"
                style="width:100%"
                data-options="label:'商品首页图片地址:',required:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-textbox urls"
                name="urls"
                style="width:100%"
                data-options="label:'商品展示图片地址:',required:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-numberbox price"
                name="price"
                style="width:100%"
                data-options="label:'商品价格:',required:true,precision:2,prefix:'￥'"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-numberbox sailnumber"
                name="sailnumber"
                style="width:100%"
                data-options="label:'商品库存:',required:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-datetimebox starttime"
                name="starttime"
                style="width:100%"
                data-options="label:'商品上架时间:',required:true"
              />
            </div>
            <div style="margin-bottom:20px">
              <input
                class="easyui-datetimebox endtime"
                name="endtime"
                style="width:100%"
                data-options="label:'商品下架时间:',required:true"
              />
            </div>
          </form>
          <div style="text-align:center;padding:5px 0">
            <a
              href="javascript:void(0)"
              class="easyui-linkbutton"
              onclick="submitForm()"
              style="width:80px"
              >提交</a
            >
            <a
              href="javascript:void(0)"
              class="easyui-linkbutton"
              onclick="clearff()"
              style="width:80px"
              >清空</a
            >
          </div>
        </div>
        <div
        id="dlg1"
        class="easyui-dialog"
        title="商品信息"
        data-options="iconCls:'icon-save',closed: true"
        style="width:400px;height:500px;padding:10px"
      >
        <form
          id="addfrom"
          class="easyui-form"
          method="post"
          data-options="required:true"
        >
          <div style="margin-bottom:20px">
            <input
              class="easyui-textbox title"
              name="title"
              style="width:100%"
              data-options="label:'商品标题:',required:true"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-textbox url"
              name="url"
              style="width:100%"
              data-options="label:'商品首页图片地址:',required:true"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-textbox urls"
              name="urls"
              style="width:100%"
              data-options="label:'商品展示图片地址:',required:true"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-numberbox price"
              name="price"
              style="width:100%"
              data-options="label:'商品价格:',required:true,precision:2"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-numberbox sailnumber"
              name="sailnumber"
              style="width:100%"
              data-options="label:'商品库存:',required:true"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-datetimebox starttime"
              name="starttime"
              style="width:100%"
              data-options="label:'商品上架时间:',required:true"
            />
          </div>
          <div style="margin-bottom:20px">
            <input
              class="easyui-datetimebox endtime"
              name="endtime"
              style="width:100%"
              data-options="label:'商品下架时间:',required:true"
            />
          </div>
        </form>
        <div style="text-align:center;padding:5px 0">
          <a
            href="javascript:void(0)"
            class="easyui-linkbutton"
            onclick="addgoods()"
            style="width:80px"
            >提交</a
          >
          <a
            href="javascript:void(0)"
            class="easyui-linkbutton"
            onclick="clearaddfrom()"
            style="width:80px"
            >清空</a
          >
        </div>
      </div>
      </div>
      <!-- <div
        data-options="region:'west',split:true"
        title="产品分类"
        style="width:200px;"
      > -->

      </div>
    </div>
  </body>
</html>

<script>
  // function submitForm() {
  //   $('#ff').form('submit', {
  //     onSubmit: function() {
  //       if (
  //         $(this)
  //           .form('enableValidation')
  //           .form('validate')
  //       ) {
  //         // 将当前页面的表单信息进行获取，然后进行ajax请求
  //         var formData = $('#ff').serializeJSON();
  //         console.log(formData._id.length);
  //         if (formData._id.length > 0) {
  //           // update
  //           $.ajax({
  //             url: `${window.parent.globalURL}product/${formData._id}`,
  //             type: 'put',
  //             data: formData
  //           }).done(function(res) {
  //             $('#dlg').dialog('close');
  //             $('#dg').datagrid('reload');
  //             $('#ff').form('clear');
  //           });
  //         } else {
  //           // add
  //           delete formData._id;
  //           $.ajax({
  //             url: `${window.parent.globalURL}product`,
  //             type: 'post',
  //             data: formData
  //           }).done(function(res) {
  //             $('#dlg').dialog('close');
  //             $('#dg').datagrid('reload');
  //             $('#ff').form('clear');
  //           });
  //         }
  //       }
  //       // 表单验证
  //     }
  //   });
  //   return false; // 阻止默认事件
  // }
  // function clearForm() {
  //   $('#ff').form('clear');
  // }
  function clearff(){
    $('#ff').form('clear');
}
function clearaddfrom(){
    $('#addfrom').form('clear');
}
//删除商品
function deleteData(sid){

$.messager.confirm('确认对话框', '你确认删除?', function(r){
    if (r){

        $.ajax({
            url:`http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/goods.php`,
            type:'post',
            dataType:'json',
            data:{
                sid:sid
            }
        }).done(function(res){
        $("#dg").datagrid('reload');
        })

    }
});

}
//增添商品
function addgoods(){
    $('#addfrom').form('submit',{
        success:function(data){
             $.ajax({
                url:`http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/addgoods.php`,
                type:'post',
                dataType:'json',
                data:{
                  title:$('#addfrom .title').val(),
                  url:$('#addfrom .url').val(),
                  urls:$('#addfrom .urls').val(),
                  price:$('#addfrom .price').val(),
                  sailnumber:$('#addfrom .sailnumber').val(),
                  starttime:$('#addfrom .starttime').val(),
                  endtime:$('#addfrom .endtime').val(),
                  submit:true,
                }
            }).done(function(res){
                alert('恭喜您，添加商品成功')
        $('#dlg1').dialog('close');
        $('#dg').datagrid('reload');
            })
        }
    });
}

  $('#dg').datagrid({
    url: `http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/goods.php`,
    fit: 'true',
    border: false,
    pagination: true,
    toolbar: '#tb',
    columns: [
      [
        { field: 'ck', checkbox: true },
        { field: 'sid', title: '商品id'},
        { field: 'title', title: '商品标题', width: 200 },
        { field: 'url', title: '商品首页图片地址', width: 200 },
        { field: 'urls', title: '商品展示图片地址', width: 200 },
        { field: 'price', title: '商品价格'},
        { field: 'sailnumber', title: '商品库存'},
        { field: 'starttime', title: '商品上架时间', width: 200 },
        { field: 'endtime', title: '商品下架时间', width: 200 },
        {
          field: '_id',
          title: '操作',
          width: 80,
          formatter: function(value, row, index) {
            return `<a href="javascript:void(0)" onclick="updateData('${
              row.sid
            }')">修改</a> <a href="javascript:void(0)" onclick="deleteData('${
              row.sid
            }')">删除</a>`;
          }
        }
      ]
    ]
  });

  function searchData(){
        $.ajax({
            url:`http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/selectgoods.php`,
            type:'post',
            dataType:'json',
            data:{
                name:$('#name').val()
            }
        }).done(function(res){
            console.log(res)
            reLodadDateGrid(res)
        })
}
//重组数据
function reLodadDateGrid(res){
	var values = [];
	 for ( var i = 0; i <res.length; i++) {
         var a = {
             'title' : res[i].title,
             'url' : res[i].url,
             'urls' : res[i].urls,
             'price' : res[i].price,
             'sailnumber' : res[i].sailnumber,
             'sid':res[i].sid,
             'starttime':res[i].starttime,
             'endtime':res[i].endtime,
         };
         values.push(a);
     }
	 $('#dg').datagrid('loadData', values);
}
//修改产品
function updateData(sid){
    $.ajax({
        url:`http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/selectgoods.php`,
        type:'post',
        dataType:'json',
            data:{
                sid:sid
            }
    }).done(function(res){
        $('#dlg').dialog('open');
        var jsonData = JSON.stringify(res);// 转成JSON格式
        var result = $.parseJSON(jsonData);// 转成JSON对象
        console.log(result[0])
        $('#ff').form('load',{
				sid:result[0].sid,
        title:result[0].title,
        url:result[0].url,
        urls:result[0].urls,
        price:result[0].price,
        sailnumber:result[0].sailnumber,
        starttime:result[0].starttime,
        endtime:result[0].endtime,
			});
    })

}

function submitForm(){
        $.messager.confirm('确认对话框', '你确认要修改产品信息吗?', function(r){
        if (r){

                    $.ajax({
                url:`http://127.0.0.1/js1810/bailianshangcheng/h51810/front/php/updategoods.php`,
                type:'post',
                dataType:'json',
                data:{
                  sid:$('#ff .sid').val(),
                  title:$('#ff .title').val(),
                  url:$('#ff .url').val(),
                  urls:$('#ff .urls').val(),
                  price:$('#ff .price').val(),
                  sailnumber:$('#ff .sailnumber').val(),
                  starttime:$('#ff .starttime').val(),
                  endtime:$('#ff .endtime').val(),
                  submit:true,
                }
            }).done(function(res){
            })
        alert('恭喜您，商品信息修改成功')
        $('#dlg').dialog('close');
        $('#dg').datagrid('reload');

     }
})
}
  $('#searchData').click(function() {
    searchData();
  });

  $('#addData').click(function() {
    $('#addfrom').form('clear');
    $('#dlg1').dialog('open');
  });

  $('#removesData').click(function() {
    deleteDatas();
  });
</script>
